# 👥 동시 접속 가능 인원 수

## 현재 상태

### ✅ 명시적인 제한 없음
- 코드에 사용자 수 제한이 설정되어 있지 않습니다
- 이론적으로는 무제한으로 참가 가능합니다

---

## ⚠️ 실제 제약사항

### 1. WebRTC P2P 연결의 특성

현재 구현은 **완전한 P2P (Peer-to-Peer)** 방식입니다.

#### 연결 구조
```
2명: 1개 연결 (A ↔ B)
3명: 3개 연결 (A ↔ B, A ↔ C, B ↔ C)
4명: 6개 연결
5명: 10개 연결
N명: N × (N-1) / 2 개 연결
```

#### 각 사용자의 연결 수
- 2명: 1개 연결
- 3명: 2개 연결
- 4명: 3개 연결
- 5명: 4개 연결
- 10명: 9개 연결
- 20명: 19개 연결

---

## 📊 실용적인 제한

### 권장 사용자 수

| 사용자 수 | 상태 | 설명 |
|----------|------|------|
| **2-4명** | ✅ **최적** | 매우 안정적, 낮은 지연 |
| **5-8명** | ⚠️ **가능** | 성능 저하 가능, 네트워크에 따라 다름 |
| **9-12명** | ⚠️ **제한적** | 성능 저하, 연결 불안정 가능 |
| **13명 이상** | ❌ **비권장** | 심각한 성능 문제, 연결 실패 빈번 |

### 실제 테스트 결과 (예상)

#### 2-4명
- ✅ 연결 안정성: 매우 높음
- ✅ 비디오 품질: 우수
- ✅ 오디오 지연: 거의 없음
- ✅ CPU 사용량: 낮음

#### 5-8명
- ⚠️ 연결 안정성: 보통
- ⚠️ 비디오 품질: 보통 (네트워크에 따라)
- ⚠️ 오디오 지연: 약간 있음
- ⚠️ CPU 사용량: 중간

#### 9-12명
- ❌ 연결 안정성: 낮음
- ❌ 비디오 품질: 낮음
- ❌ 오디오 지연: 있음
- ❌ CPU 사용량: 높음

---

## 🔧 기술적 제약사항

### 1. 브라우저 제한
- **Chrome/Edge**: 최대 약 50개 동시 WebRTC 연결 (이론적)
- **Firefox**: 최대 약 50개 동시 WebRTC 연결 (이론적)
- **실제**: CPU/메모리 제약으로 더 적은 수가 안정적

### 2. 네트워크 대역폭
- **업로드**: 각 사용자가 (N-1)명에게 스트림 전송
- **다운로드**: 각 사용자가 (N-1)명의 스트림 수신
- **예시**: 5명이면 각자 4명에게 전송 = 업로드 4배

### 3. CPU/메모리
- 각 연결마다 인코딩/디코딩 필요
- 비디오 스트림 처리 부하 증가

### 4. NAT/방화벽
- 일부 네트워크에서는 P2P 연결 실패
- STUN 서버만으로는 부족할 수 있음 (TURN 서버 필요)

---

## 💡 개선 방안 (더 많은 사용자 지원)

### 현재 방식: 완전 P2P
- ✅ 서버 부하 없음
- ✅ 구현 간단
- ❌ 사용자 수 제한

### 개선 방안 1: SFU (Selective Forwarding Unit)
- 서버가 미디어 스트림을 중계
- 각 사용자는 서버와만 연결
- **장점**: 수십~수백 명 지원 가능
- **단점**: 서버 부하 증가, 구현 복잡

### 개선 방안 2: MCU (Multipoint Control Unit)
- 서버가 모든 스트림을 합성
- **장점**: 매우 많은 사용자 지원
- **단점**: 서버 부하 매우 높음, 구현 매우 복잡

### 개선 방안 3: 하이브리드
- 소수 사용자: P2P
- 다수 사용자: SFU로 자동 전환

---

## 📝 현재 코드의 동작

### 사용자 참가 시
```python
# server.py - join_room 이벤트
rooms[room_id]["users"].append(sid)  # 제한 없음
```

### WebRTC 연결 생성
```javascript
// static/app.js - createPeerConnection
// 각 사용자가 다른 모든 사용자와 연결
for (const user of existing_users) {
    await this.createPeerConnection(user.sid, true);
}
```

**결과**: 이론적으로는 무제한, 실제로는 5-8명 권장

---

## 🎯 권장 사항

### 소규모 회의 (2-8명)
- ✅ 현재 구현으로 충분
- ✅ 추가 작업 불필요

### 중규모 회의 (9-20명)
- ⚠️ SFU 서버 도입 고려
- ⚠️ 성능 모니터링 필요

### 대규모 회의 (20명 이상)
- ❌ SFU 또는 MCU 필수
- ❌ 현재 P2P 방식으로는 불가능

---

## 🔍 실제 테스트 방법

### 테스트 시나리오

1. **2명 테스트**
   - 브라우저 2개 열기
   - 같은 방에 참가
   - 연결 안정성 확인

2. **5명 테스트**
   - 브라우저 5개 열기
   - 같은 방에 참가
   - CPU 사용량 모니터링
   - 비디오 품질 확인

3. **10명 테스트**
   - 브라우저 10개 열기
   - 성능 저하 정도 확인
   - 연결 실패율 확인

---

## 📊 성능 모니터링

### 확인할 지표

1. **브라우저 콘솔**
   - 연결 상태 로그
   - 에러 메시지
   - CPU 사용량 (Chrome DevTools)

2. **네트워크 탭**
   - WebSocket 연결 수
   - 데이터 전송량
   - 연결 품질

3. **서버 로그**
   - 사용자 수
   - 이벤트 처리 시간
   - 메모리 사용량

---

## ✅ 결론

### 현재 상태
- **명시적 제한**: 없음
- **실용적 제한**: **5-8명 권장**
- **최대 가능**: 약 10-12명 (성능 저하 있음)

### 권장 사용
- ✅ **소규모 회의 (2-8명)**: 현재 구현으로 완벽
- ⚠️ **중규모 회의 (9-15명)**: 가능하지만 성능 모니터링 필요
- ❌ **대규모 회의 (16명 이상)**: SFU 도입 권장

### 향후 개선
더 많은 사용자를 지원하려면 **SFU (Selective Forwarding Unit)** 서버를 도입하는 것이 좋습니다.

