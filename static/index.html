<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZOOM 클론 - 화상 회의</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // 백엔드 서버 URL 설정
        // 백엔드 서버: https://zoom-like.onrender.com
        window.API_BASE_URL = window.API_BASE_URL || 'https://zoom-like.onrender.com';
        window.SOCKET_SERVER_URL = window.SOCKET_SERVER_URL || window.API_BASE_URL;
        
        // URL 파라미터에서 백엔드 서버 URL 읽기 (선택사항)
        const urlParams = new URLSearchParams(window.location.search);
        const backendUrl = urlParams.get('backend');
        if (backendUrl) {
            window.API_BASE_URL = backendUrl;
            window.SOCKET_SERVER_URL = backendUrl;
        }
    </script>
</head>
<body>
    <!-- 인증 화면 (로그인/회원가입) -->
    <div id="auth" class="screen">
        <div class="auth-container">
            <div class="logo">
                <h1>🎥 ZOOM 클론</h1>
                <p>화상 회의에 참가하세요</p>
            </div>
            
            <!-- 로그인 폼 -->
            <div id="login-form" class="auth-form">
                <h2>로그인</h2>
                <input type="text" id="login-username" placeholder="사용자명" maxlength="20" required>
                <input type="password" id="login-password" placeholder="비밀번호" maxlength="100" required>
                <button type="button" id="login-btn" class="btn btn-primary">로그인</button>
                <p class="auth-link">계정이 없으신가요? <a href="#" id="show-register">회원가입</a></p>
                <p class="auth-link"><a href="#" id="show-guest">게스트로 참가</a></p>
            </div>
            
            <!-- 회원가입 폼 -->
            <div id="register-form" class="auth-form hidden">
                <h2>회원가입</h2>
                <input type="text" id="register-username" placeholder="사용자명" maxlength="20" required>
                <input type="email" id="register-email" placeholder="이메일" maxlength="100" required>
                <input type="password" id="register-password" placeholder="비밀번호 (최소 6자)" maxlength="100" required>
                <button type="button" id="register-btn" class="btn btn-primary">회원가입</button>
                <p class="auth-link">이미 계정이 있으신가요? <a href="#" id="show-login">로그인</a></p>
                <p class="auth-link"><a href="#" id="show-guest-register">게스트로 참가</a></p>
            </div>
            
            <div id="auth-error" class="error-message"></div>
        </div>
    </div>

    <!-- 로비 화면 (회의실 선택) -->
    <div id="lobby" class="screen hidden">
        <div class="lobby-container">
            <div class="logo">
                <h1>🎥 ZOOM 클론</h1>
                <p>화상 회의에 참가하세요</p>
                <p id="logged-in-user" class="logged-user"></p>
                <button id="logout-btn" class="btn btn-small">로그아웃</button>
            </div>
            <div class="lobby-form">
                <input type="text" id="username-input" placeholder="이름을 입력하세요" maxlength="20">
                <input type="text" id="target-username-input" placeholder="연결할 사용자명 (선택사항, 비우면 자동 매칭)" maxlength="20">
                <button id="connect-btn" class="btn btn-primary">연결 시작</button>
                <p class="info-text">💡 사용자명을 입력하지 않으면 자동으로 다른 사용자와 매칭됩니다</p>
            </div>
            <div id="lobby-error" class="error-message"></div>
        </div>
    </div>

    <!-- 회의 화면 -->
    <div id="meeting" class="screen hidden">
        <!-- 비디오 그리드 -->
        <div class="video-container">
            <div id="video-grid" class="video-grid">
                <!-- 비디오 요소들이 여기에 동적으로 추가됩니다 -->
            </div>
        </div>

        <!-- 컨트롤 바 -->
        <div class="controls-bar">
            <!-- 마이크 컨트롤 -->
            <div class="control-group">
                <button id="mic-btn" class="control-btn" title="마이크">
                    <span class="icon">🎤</span>
                </button>
                <div class="device-dropdown">
                    <button class="device-toggle">∨</button>
                    <div class="device-menu hidden">
                        <div class="device-section">
                            <label>마이크</label>
                            <select id="mic-select"></select>
                        </div>
                        <div class="device-section">
                            <label>스피커</label>
                            <select id="speaker-select"></select>
                            <button id="test-speaker-btn" class="test-btn">테스트</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 비디오 컨트롤 -->
            <div class="control-group">
                <button id="video-btn" class="control-btn" title="비디오">
                    <span class="icon">📹</span>
                </button>
                <div class="device-dropdown">
                    <button class="device-toggle">∨</button>
                    <div class="device-menu hidden">
                        <div class="device-section">
                            <label>카메라</label>
                            <select id="camera-select"></select>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="screen-share-btn" class="control-btn" title="화면 공유">
                <span class="icon">🖥️</span>
            </button>
            
            <button id="view-toggle-btn" class="control-btn" title="화면 보기 전환">
                <span class="icon">👁️</span>
            </button>
            
            <button id="chat-btn" class="control-btn" title="채팅">
                <span class="icon">💬</span>
            </button>
            
            <button id="record-btn" class="control-btn" title="녹화">
                <span class="icon">🔴</span>
            </button>
            
            <button id="leave-btn" class="control-btn leave" title="나가기">
                <span class="icon">📞</span>
            </button>
        </div>

        <!-- 채팅 사이드바 -->
        <div id="chat-sidebar" class="chat-sidebar hidden">
            <div class="chat-header">
                <h3>채팅</h3>
                <button id="close-chat-btn" class="close-btn">✕</button>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" placeholder="메시지를 입력하세요..." maxlength="500">
                <button id="send-btn" class="send-btn">전송</button>
            </div>
        </div>

        <!-- 참가자 목록 사이드바 -->
        <div id="participants-sidebar" class="participants-sidebar hidden">
            <div class="participants-header">
                <h3>참가자 (<span id="participants-count">0</span>)</h3>
                <button id="close-participants-btn" class="close-btn">✕</button>
            </div>
            <div id="participants-list" class="participants-list">
                <!-- 참가자 목록이 여기에 동적으로 추가됩니다 -->
            </div>
            <div id="participant-actions" class="participant-actions hidden">
                <button id="mute-all-btn" class="action-btn">전체 음소거</button>
                <button id="unmute-all-btn" class="action-btn">전체 음소거 해제</button>
            </div>
        </div>
        
        <!-- 녹화 상태 표시 -->
        <div id="recording-indicator" class="recording-indicator hidden">
            <span class="recording-dot"></span>
            <span>녹화 중...</span>
        </div>

        <!-- 사용자 정보 표시 -->
        <div id="user-info" class="user-info">
            <span id="current-username"></span>
            <span id="room-id-display"></span>
            <button id="participants-btn" class="participants-btn" title="참가자">👥</button>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>

